log_path: outputs/bess1_agent_logs
agent_name: bess1
seed: 1
is_simulation: False

feature_flags:
  wide_metrics: True
  ensemble: 2
  higher_critic_lr: True
  nominal_setpoint_bias: True
  regenerative_optimism: False # sort_noise = 0.025, action_regularization = 0.001
  normalize_return: False
  recency_bias_buffer: False

infra:
  db: # Can be the same for BESS1 and BESS2
    drivername: "postgresql+psycopg2"
    username: "postgres"
    password: "scrubber4data"
    ip: "localhost"
    port: 5432
    db_name: "postgres"
    schema: "solar"

event_bus:
  enabled: True
  cli_connection: "tcp://localhost:5571"
  app_connection: "inproc://corerl_app"

metrics:
  enabled: True
  table_name: bess1_metrics

evals:
  enabled: True
  table_name: bess1_evals

eval_cfgs:
  monte_carlo:
    enabled: True

coreio:
  coreio_origin: "tcp://localhost:5570"

env:
  name: dep_async_env
  db:
    table_name: solar_wide
    wide_format: True

interaction:
  name: dep_interaction
  restore_checkpoint: False
  obs_period: 00:05:00
  action_period: 00:05:00
  state_age_tol: 00:05:00
  update_period: 00:00:30
  warmup_period: 23:00:00
  update_warmup: 500 # number of updates before interacting
  historical_batch_size: 21024 # 73 days @ 5 minute obs period
  historical_windows:
    - [2025-09-08 17:15:00+0000, null]
  heartbeat: # Does this need to be different for BESS1/BESS2?
    connection_id: solar_matrikon
    heartbeat_node_id: "ns=3;i=8"
    heartbeat_period: 00:00:05
    max_counter: 1000

agent:
  name: greedy_ac
  gamma: 0.99

  critic:
    buffer:
      name: mixed_history_buffer
      n_most_recent: 24
      id: critic # for metric logging

  policy:
    num_samples: 512
    buffer:
      name: mixed_history_buffer
      n_most_recent: 24
      id: actor # for metric logging

pipeline:
  delta:
    delta_cfg:
      time_thresh: 00:15:00

  oddity_filter:
    defaults:
      - name: 'conditional'
        condition:
          - name: 'sympy'
            expression: "({ELS_SLR_PS1000_1A_AVAIL} == 0) & ({ELS_SLR_PS1000_1B_AVAIL} == 0)"
      - name: 'conditional'
        condition:
          - name: 'sympy'
            expression: "{ELS_SLR_BESS1_CTRL_MODE} == 0"

  imputer:
    name: per-tag
    default:
      name: copy
      imputation_horizon: 12

  # No countdown because doing Regular RL
  state_constructor:
    defaults:
      - name: multi_trace
        trace_values: [0.0, 0.75, 0.95, 0.99]

  transition_creator:
    name: all-the-time
    min_n_step: 1
    max_n_step: 1

  reward:
    priorities:
      # optimization: maximize profit
      - tags: [BESS_DEGRADATION_PROFIT]
        directions: max
        weights: [1.0]

  tags:
    # Actions
    # BESS 1
    # Want this always to be set to true
#    - name: ELS_SLR_BESS1_GRID_MODE_CMD # BESS 1 Enable Charging From Grid (Write)
#      dtype: 'bool'
#      type: ai_setpoint
#      connection_id: solar_matrikon
#      # node_identifier:
#      operating_range: [ 0.0, 1.0 ]
#      state_constructor:
#        - name: "nuke"
#      # cascade: Need Epcor to make a 'mode' tag to be able to use cascade

    - name: DEP_ELS_SLR_BESS1_SOC_SP # BESS 1 SOC Setpoint (Write)
      type: ai_setpoint
      connection_id: solar_matrikon
      node_identifier: "ns=3;i=6"
      operating_range: [20.0, 80.0]
      action_bounds: ['{DEP_ELS_SLR_BESS1_SOC_SP}-15', '{DEP_ELS_SLR_BESS1_SOC_SP}+15']
      nominal_setpoint: 50.0
#      guardrail_schedule: # Disable during offline training
#        starting_range: [45.0, 55.0] # Hitachi recommends a nominal setpoint of 50.0%
#        duration: 7 days
      cascade:
        mode: ELS_SLR_BESS1_CTRL_MODE
        op_sp: ELS_SLR_BESS1_SOC_SP_OP
        ai_sp: ELS_SLR_BESS1_SOC_SP_AI
        op_mode_val: 0
        ai_mode_val: 1

    # Want this always to be set to true/false
#    - name: ELS_SLR_BESS1_DIS_CTRL_CMD # BESS 1 Enable/Disable Discharge Rate Control (Write)
#      dtype: 'bool'
#      type: ai_setpoint
#      connection_id: solar_matrikon
#      # node_identifier:
#      operating_range: [ 0.0, 1.0 ]
#      state_constructor:
#        - name: "nuke"
#      # cascade: Need Epcor to make a 'mode' tag to be able to use cascade

    - name: DEP_ELS_SLR_BESS1_DIS_RATE_KW_SP # BESS 1 Discharge Rate Setpoint (Write)
      type: ai_setpoint
      connection_id: solar_matrikon
      node_identifier: "ns=3;i=7"
      operating_range: [0.0, 2000.0]
      action_bounds: ['{DEP_ELS_SLR_BESS1_DIS_RATE_KW_SP}-400', '{DEP_ELS_SLR_BESS1_DIS_RATE_KW_SP}+400']
      nominal_setpoint: 1000.0
      # guardrail_schedule: # Disable during offline training
      #   starting_range: [ 200.0, 600.0 ]
      #   duration: 7 days
      cascade:
        mode: ELS_SLR_BESS1_CTRL_MODE
        op_sp: ELS_SLR_BESS1_DIS_RATE_KW_SP_OP
        ai_sp: ELS_SLR_BESS1_DIS_RATE_KW_SP_AI
        op_mode_val: 0
        ai_mode_val: 1

    # Observations
    # BESS 1
    # in mapping doc: y
    - name: ELS_SLR_BESS1_CTRL_MODE
      dtype: 'bool'
      operating_range: [0.0, 1.0]
      agg: last

    # in mapping doc: y
    - name: ELS_SLR_PS1000_1A_AVAIL # BESS 1A availability
      dtype: 'bool'
      operating_range: [0.0, 1.0]
      agg: last

    # in mapping doc: y
    - name: ELS_SLR_PS1000_1B_AVAIL # BESS 1B availability
      dtype: 'bool'
      operating_range: [0.0, 1.0]
      agg: last

    # in mapping doc: y
    - name: ELS_SLR_BESS1_SOC # BESS 1 SOC
      operating_range: [0.0, 100.0]

    # in mapping doc: y
    - name: ELS_SLR_PS1000_1A_SOC # BESS 1A SOC
      operating_range: [0.0, 100.0]

    # in mapping doc: y
    - name: ELS_SLR_PS1000_1B_SOC # BESS 1B SOC
      operating_range: [0.0, 100.0]

    # in mapping doc: y
    - name: ELS_SLR_BESS1_GRID_MODE_STAT # BESS 1 Charging From Grid Enabled (Read)
      dtype: 'bool'
      operating_range: [0.0, 1.0]
      agg: last

    # in mapping doc: y
    - name: ELS_SLR_BESS1_ENG_OUT_TOT # BESS 1 Running Total Energy Discharged
      type: delta
      # Max discharge rate is 600kw
      # operating_range: [0.0, 0.05] # 0.6MW * (5 minute obs_period / 60 minutes/hour) = 0.05 MWh
      # Max discharge rate is 2MW
      operating_range: [0.0, 0.1667] # 2MW * (5 minute obs_period / 60 minutes/hour) = 0.1667 MWh
      agg: last

    # in mapping doc: y
    - name: ELS_SLR_BESS1_ENG_IN_TOT # BESS 1 Running Total Energy Charged
      type: delta
      # Max charging rate is 2MW
      operating_range: [0.0, 0.1667] # 2MW * (5 minute obs_period / 60 minutes/hour) = 0.1667 MWh
      agg: last

    # in mapping doc: y
    - name: ELS_SLR_BESS1_KW # BESS 1 Power Charged/Discharged
      # operating_range: [-2050.0, 700.0]
      operating_range: [-2100.0, 2100.0]

    # in mapping doc: y
    - name: ELS_SLR_BESS1_KVAR # BESS 1 Reactive Power Injected/Consumed
      expected_range: [ -1600.0, 1600.0 ] # From data + Kevin's feedback

    # in mapping doc: y
    - name: ELS_SLR_BESS1_DIS_CTRL_STAT # BESS 1 Enable/Disable Discharge Rate Control (Read)
      dtype: 'bool'
      operating_range: [0.0, 1.0]
      agg: last

#    # in mapping doc: y
#    - name: ELS_SLR_BESS1_DIS_RATE_KW_SP_LGC # BESS 1 Discharge Rate (Read)
#      operating_range: [0.0, 2000.0]
#      agg: last

    # WTP 1
    # in mapping doc: y
    - name: ELS_SLR_WTP1_KW # WTP 1 Power Consumed
      operating_range: [-10.0, null] # Kevin says the demand can exceed 20,000kw but no clear upper bound
      expected_range: [ 0.0, 8000.0 ] # Peak power threshold is 8800kw averaged over 15 minute window but instantaneous readings can go higher

    # in mapping doc: y
    - name: ELS_SLR_WTP1_KVAR # WTP 1 Reactive Power Consumed
      expected_range: [-100.0, 11000.0 ] # Based off data + Kevin's feedback

    # in mapping doc: y
    - name: ELS_SLR_WTP1_ENG_IN_TOT # WTP 1 Running Total Energy Consumed
      type: delta
      # Kevin says max power draw is roughly 20MW
      operating_range: [0.0, 0.834] # 10MW * (5 minute obs_period / 60 minutes/hour) = 1.67 MWh

    # WTP Loads
    # in mapping doc: y
    - name: ELS_HLP_P001_MS # Major Load 1 Run Status
      dtype: 'bool'
      operating_range: [ 0.0, 1.0 ]
      agg: last

    # in mapping doc: y
    - name: ELS_HLP_P002_MS # Major Load 2 Run Status
      dtype: 'bool'
      operating_range: [ 0.0, 1.0 ]
      agg: last

    # in mapping doc: y
    - name: ELS_HLP_P003_MS # Major Load 3 Run Status
      dtype: 'bool'
      operating_range: [ 0.0, 1.0 ]
      agg: last

    # in mapping doc: y
    - name: ELS_HLP_P004_MS # Major Load 4 Run Status
      dtype: 'bool'
      operating_range: [ 0.0, 1.0 ]
      agg: last

    # in mapping doc: y
    - name: EL_LLP_P1_MS_STAT # Light Load 1 Run Status
      dtype: 'bool'
      operating_range: [ 0.0, 1.0 ]
      agg: last

    # in mapping doc: y
    - name: EL_LLP_P2_MS_STAT # Light Load 2 Run Status
      dtype: 'bool'
      operating_range: [ 0.0, 1.0 ]
      agg: last

    # in mapping doc: y
    - name: EL_LLP_P3_MS_STAT # Light Load 3 Run Status
      dtype: 'bool'
      operating_range: [ 0.0, 1.0 ]
      agg: last

    # in mapping doc: y
    - name: EL_LLP_P4_MS_STAT # Light Load 4 Run Status
      dtype: 'bool'
      operating_range: [ 0.0, 1.0 ]
      agg: last

    # in mapping doc: y
    - name: EL_LLP_P5_MS_STAT # Light Load 5 Run Status
      dtype: 'bool'
      operating_range: [ 0.0, 1.0 ]
      agg: last

    # SOLAR 1
    # in mapping doc: y
    - name: ELS_SLR_SOLAR1_KW # SOLAR 1 Power Produced
      operating_range: [-50.0, 7200.0] # Max amount of power that can pass through inverters

    # in mapping doc: y
    - name: ELS_SLR_SOLAR1_KVAR # SOLAR 1 Power Injected/Consumed
      expected_range: [-500.0, 3500.0] # From data

    # in mapping doc: y
    - name: ELS_SLR_SOLAR1_ENG_OUT_TOT # SOLAR 1 Running Total Energy Generated
      type: delta
      # Solar power generation capped at 7.2MW
      operating_range: [0.0, 0.6] # 7.2MW * (5 minute obs_period / 60 minutes/hour) = 0.6MWh

    # in mapping doc: y
    - name: ELS_SLR_INV1_AVAIL # SOLAR 1 Inverter 1 Enabled/Disabled
      dtype: 'bool'
      operating_range: [ 0.0, 1.0 ]
      agg: last

    # in mapping doc: y
    - name: ELS_SLR_INV3_AVAIL # SOLAR 1 Inverter 3 Enabled/Disabled
      dtype: 'bool'
      operating_range: [ 0.0, 1.0 ]
      agg: last

    # in mapping doc: y
    - name: ELS_SLR_SOLAR1_LIMIT_LGC # SOLAR 1 Inverter Limit
      operating_range: [0.0, 100.0]

    # P72
    # in mapping doc: y
    - name: ELS_SLR_ELSP72_KW # P72 Power Imported/Exported
      operating_range: [null, 5000.0] # Hitachi controller limits export to 4.85MW. No import limit but don't want to violate peak power constraint
      expected_range: [-8800.0, 5000.0] # Lower bound is based on Kevin's feedback
      # expected_range: [-20000.0, 5000.0] # Lower bound is based on Kevin's feedback
      # yellow_bounds: [ null, 4700.0 ] # Discourage curtailment

    # in mapping doc: y
    - name: ELS_SLR_ELSP72_KVAR # P72 Reactive Power Injected/Consumed
      expected_range: [ -1000.0, 4000.0 ] # From data

    # in mapping doc: y
    - name: ELS_SLR_ELSP72_ENG_IN_TOT # P72 Running Total Energy Imported
      type: delta
      # Peak power constraint is 8.8MW
      operating_range: [ 0.0, 0.75 ] # 8.8MW * (5 minute obs_period / 60 minutes/hour) = 0.7334 MWh. Set to 1 for buffer
      # Peak Power Constraint
#      yellow_bounds:
#        - null
#        - '0.95 * ({ELS_SLR_ELSP72_POWER_PEAK_SP_LGC} * 5 / 60)'
#      red_bounds:
#        - null
#        - '{ELS_SLR_ELSP72_POWER_PEAK_SP_LGC} * 5 / 60'
#      red_zone_reaction: # Disable during offline training
#        - tag: DEP_ELS_SLR_BESS1_SOC_SP
#          kind: upper_violation
#          bounds: [ 20.0, 21.0 ]
#        - tag: ELS_SLR_BESS1_DIS_RATE_KW_SP
#          kind: upper_violation
#          bounds: [ 1999.0, 2000.0 ]

    # in mapping doc: y
    - name: ELS_SLR_ELSP72_ENG_OUT_TOT # P72 Running Total Energy Exported
      type: delta
      operating_range: [0.0, 0.5] # Exports sometimes exceed 4.85MW limit

    # in mapping doc: y
    - name: ELS_SLR_ELSP72_MAJORITY_LGC # P72 % Of SOLAR 1 Generated Power Used On-Site In Given Year
      operating_range: [0.0, 100.0]

    # in mapping doc: y
    - name: ELS_SLR_ELSP72_POWER_PEAK_SP_LGC # P72 Peak Shaving Setpoint
      operating_range: [0.0, null]
      expected_range: [0.0, 7.92] # 90% of 8800kw
      agg: last

    # Environmental Factors
    # in mapping doc: y
    - name: ELS_SITE_MET_POA # Solar Irradiance On Solar Panels
      operating_range: [0.0, null]
      expected_range: [ 0.0, 1400.0 ]

    # in mapping doc: y
    - name: ELS_SITE_MET_BOP_TEMP # Solar Panel Temperature
      expected_range: [-50.0, 70.0]

    # in mapping doc: y
    - name: ELS_SITE_MET_OUT_TEMP # Air Temperature
      expected_range: [-50.0, 50.0]

    # Costs
    # in mapping doc: y
    - name: ELS_SLR_ENG_IMPORT_COST_SP # Negotiated Cost EPCOR Pays For Importing Energy From The Grid ($/MWh)
      agg: last
      expected_range: [0.0, 100.0]

    # in mapping doc: y
    - name: ELS_SLR_ENG_EXPORT_FEE_SP # Trading Cost For Exporting Energy Back To Grid ($/MWh)
      agg: last
      expected_range: [0.0, 1.0]

    # in mapping doc: y
    - name: ELS_SLR_ENG_BATT_COST_SP # BESS Battery Degradation Cost ($/MWh)
      agg: last
      expected_range: [0.0, 100.0]

    # AESO Price/Load Forecasts
    # in mapping doc: y
    - name: Current_AIL # Current Alberta Internal Load
      operating_range: [0.0, null]
      expected_range: [6000.0, 15000.0]
      agg: last

    # in mapping doc: y
    - name: Forecast_AIL_1 # Alberta Internal Load Forecast Next Hour
      operating_range: [ 0.0, null ]
      expected_range: [6000.0, 15000.0]
      agg: last

    # in mapping doc: y
    - name: Forecast_AIL_2 # Alberta Internal Load Forecast In 2 Hours
      operating_range: [ 0.0, null ]
      expected_range: [6000.0, 15000.0]
      agg: last

    # in mapping doc: y
    - name: Forecast_AIL_3 # Alberta Internal Load Forecast In 3 Hours
      operating_range: [ 0.0, null ]
      expected_range: [6000.0, 15000.0]
      agg: last

    # in mapping doc: y
    - name: Computed_Pool_Price # Pool price computed from average of system marginal prices
      expected_range: [0.0, 1000.0]
      # expected_range: [-500.0, 3000.0]
      agg: last

    # in mapping doc: y
    - name: Forecast_Pool_Price_1 # Pool Price Forecast For Current Hour
      expected_range: [0.0, 1000.0]
      # expected_range: [-500.0, 3000.0]
      agg: last

    # in mapping doc: y
    - name: Forecast_Pool_Price_2 # Pool Price Forecast For Next Hour
      expected_range: [0.0, 1000.0]
      # expected_range: [-500.0, 3000.0]
      agg: last

    # in mapping doc: y
    - name: Forecast_Pool_Price_3 # Pool Price Forecast For 2 Hours From Now
      expected_range: [0.0, 1000.0]
      # expected_range: [-500.0, 3000.0]
      agg: last

    # Seasonal Tags
    - name: day_of_year
      type: seasonal
    - name: day_of_week
      type: seasonal
    - name: time_of_day
      type: seasonal
    - name: second_in_hour
      type: seasonal

    # Virtual Sensors
    - name: P72_MAJORITY_ON_SITE_SIGMOID # (1 - ELS_SLR_ELSP72_MAJORITY_LGC) * Sigmoid
      is_computed: True
      # Since sigmoid starts small, we want a constraint that's violated when it gets too large
      # So we use 1 - ELS_SLR_ELSP72_MAJORITY_LGC to represent % of generated energy sold back to the grid
      value: '(100 - {ELS_SLR_ELSP72_MAJORITY_LGC}) * (1 / (1 + 2.71828**(-1*(({day_of_year} - 250) / 20))))'
      operating_range: [ 0.0, 100.0 ]
      yellow_bounds: [ null, 48.0 ]
      red_bounds: [ null, 49.8 ] # Set at 49.8% to give small buffer on constraint
#      red_zone_reaction: # Disable during offline training
#        - tag: DEP_ELS_SLR_BESS1_SOC_SP
#          kind: upper_violation
#          bounds: [ 79.0, 80.0 ]
#        - tag: ELS_SLR_BESS1_DIS_RATE_KW_SP
#          kind: upper_violation
#          bounds: [ 0.0, 1.0 ]

    - name: IS_PEAK_SHAVING
      is_computed: True
      value: '((-0.001 * {ELS_SLR_ELSP72_KW}) > (0.99 * {ELS_SLR_ELSP72_POWER_PEAK_SP_LGC})) | ({ELS_SLR_ELSP72_ENG_IN_TOT} > ((0.99 * {ELS_SLR_ELSP72_POWER_PEAK_SP_LGC}) * 5 / 60))'
      operating_range: [ 0.0, 1.0 ]

    - name: PEAK_SHAVING_CONSTRAINT
      is_computed: True
      # Don't want constraint violations when IS_PEAK_SHAVING is False and acts as a 0
      # Reforumulated with (100 - {ELS_SLR_BESS1_SOC})
      value: '{IS_PEAK_SHAVING} * (100 - {ELS_SLR_BESS1_SOC})'
      operating_range: [ 0.0, 100.0 ]
      yellow_bounds: [null, 60]
      red_bounds: [null, 80]

    - name: BESS_DEGRADATION_COST
      is_computed: True
      value: '{ELS_SLR_ENG_BATT_COST_SP} * ({ELS_SLR_BESS1_ENG_IN_TOT} + {ELS_SLR_BESS1_ENG_OUT_TOT})'
      operating_range: [ 0.0, null ]
      expected_range: [ 0.0, 16.67 ] # Using ELS_SLR_BESS1_ENG_IN_TOT operating_range of [0.0, 0.1667] and assuming max degradation cost of $100/MWh

    - name: ENERGY_COST
      is_computed: True
      value: '{ELS_SLR_ENG_IMPORT_COST_SP} * {ELS_SLR_ELSP72_ENG_IN_TOT}'
      operating_range: [ 0.0, 75.0 ]
      state_constructor:
        - name: "nuke"

    - name: ENERGY_SOLD
      is_computed: True
      value: '({Computed_Pool_Price} - {ELS_SLR_ENG_EXPORT_FEE_SP}) * {ELS_SLR_ELSP72_ENG_OUT_TOT}'
      # Max Pool Price is currently $3000/MWh * 4.85MW Max Power Export * 1 substation * (5 / 60) hours = $1212.5
      # Min Pool Price is currently $-500/MWh * 4.85MW Max Power Export * 1 substation * (5 / 60) hours = $-202.085
      # operating_range: [ -202.085, 1212.5 ]
      expected_range: [-0.5, 500.0]
      state_constructor:
        - name: "nuke"

    - name: OVERALL_PROFIT
      is_computed: True
      value: '{ENERGY_SOLD} - {ENERGY_COST}'
      # operating_range: [ -318.755, 1212.5 ]
      expected_range: [ -75.0, 500.0 ]
      state_constructor:
        - name: "nuke"

    # New Reward
    # Cost to charge battery
    # 1. Solar <= WTP demand -> Charging at grid price
    # 2. Solar > WTP demand -> Charging at pool price
    - name: CHARGING_FROM_GRID
      is_computed: True
      value: '({ELS_SLR_SOLAR1_ENG_OUT_TOT} <= {ELS_SLR_WTP1_ENG_IN_TOT}) & ({ELS_SLR_BESS1_ENG_IN_TOT} > 0)'
      operating_range: [0, 1]

    - name: CHARGING_FROM_SOLAR
      is_computed: True
      value: '(({ELS_SLR_SOLAR1_ENG_OUT_TOT} > {ELS_SLR_WTP1_ENG_IN_TOT}) & ({ELS_SLR_BESS1_ENG_IN_TOT} > 0)) & ({ELS_SLR_ELSP72_KW} < 4850)'
      operating_range: [0, 1]

    - name: CHARGING_FROM_GRID_COST
      is_computed: True
      value: '{CHARGING_FROM_GRID} * {ELS_SLR_BESS1_ENG_IN_TOT} * {ELS_SLR_ENG_IMPORT_COST_SP}'
      # 0.1667MWh * $100/MWh = $16.67
      operating_range: [0.0, 16.67]

    - name: CHARGING_FROM_SOLAR_COST
      is_computed: True
      value: '{CHARGING_FROM_SOLAR} * {ELS_SLR_BESS1_ENG_IN_TOT} * {Computed_Pool_Price}'
      # 0.1667MWh * $1000.0/MWh = $166.7
      operating_range: [ 0.0, 166.7 ]
      # 0.1667MWh * -$500.0/MWh = -$83.35
      # 0.1667MWh * $3000.0/MWh = $500.10
      # operating_range: [-83.35, 500.1]

    # Revenue from discharging battery
    # 1. Solar > WTP demand -> Discharge at pool price
    # 2. Solar + Bess discharge power < WTP demand -> Discharge at grid price
    # 3. Solar < WTP but Solar + Bess discharge power > WTP demand -> Power needed to reach WTP demand discharged at grid price and the surplus sold at pool price
    - name: ALL_ENERGY_DISCHARGED_POOL_PRICE
      is_computed: True
      value: '({ELS_SLR_SOLAR1_ENG_OUT_TOT} >= {ELS_SLR_WTP1_ENG_IN_TOT}) & ({ELS_SLR_BESS1_ENG_OUT_TOT} > 0)'
      operating_range: [ 0, 1 ]

    - name: ALL_ENERGY_DISCHARGED_GRID_PRICE
      is_computed: True
      value: '(({ELS_SLR_SOLAR1_ENG_OUT_TOT} + {ELS_SLR_BESS1_ENG_OUT_TOT}) <= {ELS_SLR_WTP1_ENG_IN_TOT}) & ({ELS_SLR_BESS1_ENG_OUT_TOT} > 0)'
      operating_range: [0, 1]

    - name: SOME_ENERGY_DISCHARGED_POOL_PRICE
      is_computed: True
      value: '((({ELS_SLR_SOLAR1_ENG_OUT_TOT} + {ELS_SLR_BESS1_ENG_OUT_TOT}) > {ELS_SLR_WTP1_ENG_IN_TOT}) & ({ELS_SLR_SOLAR1_ENG_OUT_TOT} < {ELS_SLR_WTP1_ENG_IN_TOT})) & ({ELS_SLR_BESS1_ENG_OUT_TOT} > 0)'
      operating_range: [ 0, 1 ]

    - name: DISCHARGED_POOL_PRICE_REVENUE
      is_computed: True
      value: '({ALL_ENERGY_DISCHARGED_POOL_PRICE} * {ELS_SLR_BESS1_ENG_OUT_TOT} * ({Computed_Pool_Price} - {ELS_SLR_ENG_EXPORT_FEE_SP})) + ({SOME_ENERGY_DISCHARGED_POOL_PRICE} * ({ELS_SLR_SOLAR1_ENG_OUT_TOT} + {ELS_SLR_BESS1_ENG_OUT_TOT} - {ELS_SLR_WTP1_ENG_IN_TOT}) * ({Computed_Pool_Price} - {ELS_SLR_ENG_EXPORT_FEE_SP}))'
      # 0.05MWh * ($1000/MWh - $0/MWh) = $50
      # operating_range: [ -0.1667, 50.0 ]
      operating_range: [-0.1667, 166.7]
      # 0.1667MWh * (-$500/MWh - $1/MWh) = -$83.52
      # 0.1667MWh * ($3000/MWh - $0/MWh) = $500.10
      # operating_range: [-83.52, 500.1]

    - name: DISCHARGED_GRID_PRICE_REVENUE
      is_computed: True
      value: '({ALL_ENERGY_DISCHARGED_GRID_PRICE} * {ELS_SLR_BESS1_ENG_OUT_TOT} * {ELS_SLR_ENG_IMPORT_COST_SP}) + ({SOME_ENERGY_DISCHARGED_POOL_PRICE} * ({ELS_SLR_WTP1_ENG_IN_TOT} - {ELS_SLR_SOLAR1_ENG_OUT_TOT}) * {ELS_SLR_ENG_IMPORT_COST_SP})'
      # 0.05MWh * $100/MWh = $5
      operating_range: [ 0.0, 16.67]
      # 0.1667MWh * $100/MWh = $16.67
      # operating_range: [0.0, 16.67]

    - name: BESS_PROFIT
      is_computed: True
      value: '({DISCHARGED_POOL_PRICE_REVENUE} + {DISCHARGED_GRID_PRICE_REVENUE}) - ({CHARGING_FROM_SOLAR_COST} + {CHARGING_FROM_GRID_COST})'
      # ($0 + $0) - ($166.7 + $0) = -$166.7
      # ($50 + $0) - ($0 + $0) = $50
      operating_range: [-166.7, 166.7 ]
      # ($0 + $0) - ($500.1 + $0) = -$500.1
      # ($500.1 + $0) - ($0 + $0) = $500.1
      # operating_range: [-500.1, 500.1]

    - name: BESS_DEGRADATION_PROFIT
      is_computed: True
      value: '{BESS_PROFIT} - {BESS_DEGRADATION_COST}'
      # -$166.7 - $16.67 = -$183.37
      # $50 - $5 = $45
      operating_range: [ -183.37, 150.03 ]
      # -$500.1 - $16.67 = -$516.77
      # $500.1 - $16.67 = $483.43
      # operating_range: [-516.77, 483.43]
